<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表單申請&查詢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f5f5f5;
            padding: 20px;
        }
        .query-container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-label {
            font-weight: 500;
            color: #333;
        }
        .result-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .table-responsive {
            margin-top: 15px;
        }
        table {
            font-size: 14px;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .required {
            color: red;
            margin-left: 2px;
        }
        .btn-search {
            background-color: #8a9199;
            border-color: #8a9199;
            color: white;
            margin-right: 10px;
        }
        .btn-search:hover {
            background-color: #6c757d;
            border-color: #6c757d;
        }
        .btn-apply {
            background-color: #6ea8fe;
            border-color: #6ea8fe;
            color: white;
        }
        .btn-apply:hover {
            background-color: #0d6efd;
            border-color: #0d6efd;
            color: white;
        }
        .btn-export {
            background-color: #198754;
            border-color: #198754;
            color: white;
        }
        .btn-export:hover {
            background-color: #157347;
            border-color: #146c43;
            color: white;
        }
        .btn-open {
            background-color: #ffb380;
            border-color: #ffb380;
            color: white;
            padding: 2px 12px;
            font-size: 12px;
        }
        .btn-open:hover {
            background-color: #ff9f5c;
            border-color: #ff9850;
            color: white;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .table-responsive.empty {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="query-container">
            <h2 class="mb-4">表單查詢</h2>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">表單名稱<span class="required">*</span></label>
                    <select class="form-select" id="form" onchange="search()">
                        <option value="">請選擇表單</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">案場</label>
                    <select class="form-select" id="site" onchange="search()">
                        <option value="">不限</option>
                        <option value="皇普MOMA">皇普MOMA</option>
                        <option value="昕見築">昕見築</option>
                        <option value="長堤凰澄">長堤凰澄</option>
                        <option value="智匯學">智匯學</option>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">處理種類</label>
                    <select class="form-select" id="category" onchange="toggleApplicantField(); search();">
                        <option value="">不限</option>
                        <option value="人事">本人申請表單</option>
                        <option value="行政">本人承辦表單</option>
                    </select>
                </div>
                <div class="col-md-6" id="applicantField" style="display: none;">
                    <label class="form-label">送單人</label>
                    <input type="text" class="form-control" id="applicant" oninput="search()">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">申請日期</label>
                    <div class="row">
                        <div class="col-5">
                            <input type="date" class="form-control" id="startDate" onchange="search()">
                        </div>
                        <div class="col-2 text-center pt-2">-</div>
                        <div class="col-5">
                            <input type="date" class="form-control" id="endDate" onchange="search()">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">狀態</label>
                    <select class="form-select" id="status" onchange="search()">
                        <option value="" selected>不限</option>
                        <option value="審批中">審批中</option>
                        <option value="已結案">已結案</option>
                        <option value="被取消">被取消</option>
                        <option value="被暫停">被暫停</option>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-12 text-end">
                    <button class="btn btn-search" onclick="search()">
                        <i class="bi bi-search"></i> 查詢
                    </button>
                    <button class="btn btn-apply" onclick="applyForm()">
                        <i class="bi bi-plus-circle"></i> 申請
                    </button>
                </div>
            </div>
        </div>

        <div class="result-container" id="resultContainer">
            <div class="result-header">
                <h5 id="resultCount">查詢結果：共 0 筆資料</h5>
                <button class="btn btn-export" onclick="exportData()">
                    <i class="bi bi-download"></i> 匯出
                </button>
            </div>
            <div class="table-responsive empty" id="tableContainer">
                <table class="table table-hover table-bordered">
                    <thead>
                        <tr>
                            <th>案場</th>
                            <th>申請人</th>
                            <th>狀態</th>
                            <th>送單人</th>
                            <th>申請日期</th>
                            <th>目前關卡</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="resultTable">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 模擬資料 - 共 15 筆
        const data = [
            {
                formName: '人事｜名片申請',
                status: '審批中',
                site: '皇普MOMA',
                applicantName: '王小明',
                applicant: '葉清宗',
                applyTime: '2025/12/19 15:21:49',
                currentStage: '02-人事(陳姿璇)'
            },
            {
                formName: '人事｜名片申請',
                status: '已結案',
                site: '昕見築',
                applicantName: '張大華',
                applicant: '邱世華',
                applyTime: '2025/12/11 09:51:33',
                currentStage: '03-行政(陳孝求)、03-行政(會簽)(葉清宗,黃正忠,李美貞)'
            },
            {
                formName: '人事｜名片申請',
                status: '被取消',
                site: '長堤凰澄',
                applicantName: '陳美玲',
                applicant: '李俐君',
                applyTime: '2025/12/02 16:37:31',
                currentStage: '05-執行長(黃正忠)'
            },
            {
                formName: '人事｜名片申請',
                status: '被暫停',
                site: '智匯學',
                applicantName: '林志明',
                applicant: '李俐君',
                applyTime: '2025/12/02 16:22:21',
                currentStage: '04-總經理(葉清宗)'
            },
            {
                formName: '人事｜名片申請',
                status: '審批中',
                site: '皇普MOMA',
                applicantName: '黃建國',
                applicant: '李俐君',
                applyTime: '2025/12/02 16:20:30',
                currentStage: '01-申請人(李俐君)'
            },
            {
                formName: '人事｜名片申請',
                status: '已結案',
                site: '昕見築',
                applicantName: '吳佳玲',
                applicant: '陳姿璇',
                applyTime: '2025/12/02 14:21:43',
                currentStage: '07-總經理(葉清宗)、08-執行長(黃正忠)'
            },
            {
                formName: '人事｜名片申請',
                status: '審批中',
                site: '長堤凰澄',
                applicantName: '劉家豪',
                applicant: '張文華',
                applyTime: '2025/11/28 10:15:22',
                currentStage: '03-行政(李美貞)'
            },
            {
                formName: '人事｜名片申請',
                status: '已結案',
                site: '智匯學',
                applicantName: '周雅婷',
                applicant: '黃正忠',
                applyTime: '2025/11/25 14:33:18',
                currentStage: '06-總經理(葉清宗)'
            },
            {
                formName: '人事｜名片申請',
                status: '被取消',
                site: '皇普MOMA',
                applicantName: '鄭立偉',
                applicant: '陳孝求',
                applyTime: '2025/11/20 11:48:55',
                currentStage: '02-人事(陳姿璇)'
            },
            {
                formName: '人事｜名片申請',
                status: '審批中',
                site: '昕見築',
                applicantName: '許雅芳',
                applicant: '葉清宗',
                applyTime: '2025/11/18 09:27:41',
                currentStage: '04-總經理(葉清宗)'
            },
            {
                formName: '人事｜試用員工考核表',
                status: '審批中',
                site: '皇普MOMA',
                applicantName: '林佳慧',
                department: '業務部',
                applicant: '陳姿璇',
                applyTime: '2025/12/15 10:30:25',
                currentStage: '02-人事(陳姿璇)'
            },
            {
                formName: '人事｜試用員工考核表',
                status: '已結案',
                site: '昕見築',
                applicantName: '蔡志偉',
                department: '行銷部',
                applicant: '黃正忠',
                applyTime: '2025/11/20 14:15:30',
                currentStage: '05-執行長(黃正忠)'
            },
            {
                formName: '會議記錄',
                status: '審批中',
                site: '皇普MOMA',
                applicantName: '張經理',
                applicant: '李秘書',
                applyTime: '2025/12/20 14:30:15',
                currentStage: '02-主管審核(張經理)',
                meetingType: '週會',
                meetingTime: '2025/12/20 09:00',
                location: '總公司會議室A',
                chairman: '張經理',
                recorder: '李秘書'
            },
            {
                formName: '會議記錄',
                status: '已結案',
                site: '昕見築',
                applicantName: '陳部長',
                applicant: '王助理',
                applyTime: '2025/12/18 10:45:22',
                currentStage: '03-歷程歸檔(人事部)',
                meetingType: '月會',
                meetingTime: '2025/12/18 14:00',
                location: '昕見築會議室B',
                chairman: '陳部長',
                recorder: '王助理'
            },
            {
                formName: '會議記錄',
                status: '審批中',
                site: '長堤凰澄',
                applicantName: '劉總監',
                applicant: '林秘書',
                applyTime: '2025/12/17 16:20:08',
                currentStage: '01-會議主持人確認(劉總監)',
                meetingType: '週會',
                meetingTime: '2025/12/17 15:30',
                location: '長堤凰澄辦公室',
                chairman: '劉總監',
                recorder: '林秘書'
            }
        ];

        // 初始化表單下拉選單
        function initFormDropdown() {
            const formSelect = document.getElementById('form');
            const uniqueForms = [...new Set(data.map(item => item.formName))];
            uniqueForms.forEach(form => {
                const option = document.createElement('option');
                option.value = form;
                option.textContent = form;
                formSelect.appendChild(option);
            });
        }

        // 搜尋函數
        function search() {
            const category = document.getElementById('category').value;
            const status = document.getElementById('status').value;
            const form = document.getElementById('form').value;
            const site = document.getElementById('site').value;
            const applicant = document.getElementById('applicant').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            // 如果沒有選擇表單，顯示 0 筆資料
            if (!form) {
                displayResults([]);
                return;
            }

            let filtered = data.filter(item => {
                // 狀態篩選
                if (status && item.status !== status) return false;
                
                // 表單名稱篩選
                if (form && item.formName !== form) return false;
                
                // 案場篩選
                if (site && item.site !== site) return false;
                
                // 送單人篩選
                if (applicant && !item.applicant.includes(applicant)) return false;
                
                // 申請日期篩選
                if (startDate || endDate) {
                    const itemDate = item.applyTime.split(' ')[0]; // 取得日期部分
                    if (startDate && itemDate < startDate) return false;
                    if (endDate && itemDate > endDate) return false;
                }
                
                return true;
            });

            displayResults(filtered);
        }

        // 顯示結果
        function displayResults(results) {
            const tbody = document.getElementById('resultTable');
            const countDiv = document.getElementById('resultCount');
            const tableContainer = document.getElementById('tableContainer');
            const tableHead = tableContainer.querySelector('thead tr');
            
            countDiv.textContent = `查詢結果：共 ${results.length} 筆資料`;
            tbody.innerHTML = '';

            // 如果沒有資料，隱藏表格
            if (results.length === 0) {
                tableContainer.classList.add('empty');
                return;
            }

            // 有資料時顯示表格
            tableContainer.classList.remove('empty');

            // 根據表單類型調整表格標題
            const form = document.getElementById('form').value;
            if (form === '人事｜試用員工考核表') {
                tableHead.innerHTML = `
                    <th>案場</th>
                    <th>員工姓名</th>
                    <th>現職單位</th>
                    <th>狀態</th>
                    <th>送單人</th>
                    <th>申請日期</th>
                    <th>目前關卡</th>
                    <th>操作</th>
                `;
            } else if (form === '會議記錄') {
                tableHead.innerHTML = `
                    <th>週會/月會</th>
                    <th>時間</th>
                    <th>地點</th>
                    <th>主席</th>
                    <th>紀錄</th>
                    <th>狀態</th>
                    <th>送單人</th>
                    <th>申請日期</th>
                    <th>目前關卡</th>
                    <th>操作</th>
                `;
            } else {
                tableHead.innerHTML = `
                    <th>案場</th>
                    <th>申請人</th>
                    <th>狀態</th>
                    <th>送單人</th>
                    <th>申請日期</th>
                    <th>目前關卡</th>
                    <th>操作</th>
                `;
            }

            results.forEach((item, index) => {
                const row = document.createElement('tr');
                
                if (form === '人事｜試用員工考核表') {
                    row.innerHTML = `
                        <td>${item.site}</td>
                        <td>${item.applicantName}</td>
                        <td>${item.department || '-'}</td>
                        <td>${item.status}</td>
                        <td>${item.applicant}</td>
                        <td>${item.applyTime}</td>
                        <td>${item.currentStage}</td>
                        <td>
                            <button class="btn btn-open" onclick="openForm(${index})">開啟</button>
                        </td>
                    `;
                } else if (form === '會議記錄') {
                    row.innerHTML = `
                        <td>${item.meetingType}</td>
                        <td>${item.meetingTime}</td>
                        <td>${item.location}</td>
                        <td>${item.chairman}</td>
                        <td>${item.recorder}</td>
                        <td>${item.status}</td>
                        <td>${item.applicant}</td>
                        <td>${item.applyTime}</td>
                        <td>${item.currentStage}</td>
                        <td>
                            <button class="btn btn-open" onclick="openForm(${index})">開啟</button>
                        </td>
                    `;
                } else {
                    row.innerHTML = `
                        <td>${item.site}</td>
                        <td>${item.applicantName}</td>
                        <td>${item.status}</td>
                        <td>${item.applicant}</td>
                        <td>${item.applyTime}</td>
                        <td>${item.currentStage}</td>
                        <td>
                            <button class="btn btn-open" onclick="openForm(${index})">開啟</button>
                        </td>
                    `;
                }
                tbody.appendChild(row);
            });
        }

        // 切換申請人欄位顯示
        function toggleApplicantField() {
            const category = document.getElementById('category').value;
            const applicantField = document.getElementById('applicantField');
            
            if (category === '行政') {
                applicantField.style.display = 'block';
            } else {
                applicantField.style.display = 'none';
                document.getElementById('applicant').value = '';
            }
        }

        // 申請表單函數
        function applyForm() {
            // 這裡可以加入申請表單的邏輯
            alert('開啟申請表單');
            // 例如：window.location.href = 'apply_form.html';
        }

        // 匯出資料函數
        function exportData() {
            // 這裡可以加入匯出功能的邏輯
            alert('匯出資料功能');
            // 例如：匯出為 Excel 或 CSV
        }

        // 開啟表單函數
        function openForm(index) {
            const item = data[index];
            alert(`開啟表單：${item.formName}\n申請人：${item.applicantName}`);
            // 這裡可以加入開啟表單的邏輯
            // 例如：window.location.href = `form_detail.html?id=${index}`;
        }

        // 初始化
        window.onload = function() {
            initFormDropdown();
            toggleApplicantField();
            displayResults([]); // 初始顯示 0 筆資料
        };
    </script>
</body>
</html>
